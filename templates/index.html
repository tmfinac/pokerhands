<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ポーカー役判定</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .marks button, .cards button { margin: 5px; padding: 10px 15px; font-size: 16px; }
        #selected-cards { margin-top: 15px; font-weight: bold; font-size: 18px; }
        #selected-cards img { width: 50px; margin-right: 5px; vertical-align: middle; }
        #result { margin-top: 10px; font-size: 20px; color: blue; }
    </style>
</head>
<body>

<h2>マークを選択してください</h2>
<div class="marks">
    {% for mark in marks %}
    <a href="{{ url_for('select_mark', mark=mark) }}"><button>{{ mark }}</button></a>
    {% endfor %}
</div>

{% if current_mark %}
<h3>{{ current_mark }} のカードを選択してください</h3>
<div class="cards" id="cards">
    {% for card in cards %}
    <img src="{{ url_for('static', filename='cards/' + card[1:] + card[0] + '.png') }}" alt="{{ card }}" onclick="selectCard('{{ card }}')" style="width:50px; cursor:pointer;">
    {% endfor %}
</div>
{% endif %}

<div>
    <h3>選択カード:</h3>
    <div id="selected-cards">
        {% for c in selected %}
        <img src="{{ url_for('static', filename='cards/' + c[1:] + c[0] + '.png') }}" alt="{{ c }}">
        {% endfor %}
    </div>

    <h3>役:</h3>
    <div id="result">{{ result }}</div>
</div>

<div style="margin-top:20px;">
    <a href="{{ url_for('reset') }}"><button>リセット</button></a>
</div>

<script>
function selectCard(card) {
    fetch("/add_ajax/" + card)
    .then(response => response.json())
    .then(data => {
        // 選択カードを画像で更新
        const container = document.getElementById("selected-cards");
        container.innerHTML = "";
        data.selected_imgs.forEach(src => {
            const img = document.createElement("img");
            img.src = src;
            container.appendChild(img);
        });

        // 役を更新
        document.getElementById("result").textContent = data.result;

        // 5枚選んだらクリック無効化
        if (data.selected.length >= 5) {
            document.querySelectorAll("#cards img").forEach(el => {
                el.style.pointerEvents = "none";
                el.style.opacity = 0.5;
            });
        }
    });
}
</script>

</body>
</html>