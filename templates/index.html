<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ポーカー役判定</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; padding: 10px; }
.marks button, .cards img { margin: 5px; padding: 10px; font-size: 16px; }
.cards img { width: 50px; cursor: pointer; }
#selected-cards { display: flex; flex-wrap: wrap; margin-bottom: 10px; }
#selected-cards img { width: 50px; margin-right: 5px; margin-bottom: 5px; }
#result { font-size: 18px; color: blue; margin-top: 10px; }
@media (max-width: 600px) {
    .cards img, #selected-cards img { width: 40px; }
}
</style>
</head>
<body>

<h2>選択カード</h2>
<div id="selected-cards">
    {% for card in selected %}
    <img src="{{ url_for('static', filename='cards/' + card_filename(card)) }}" alt="{{ card }}">
    {% endfor %}
</div>

<h2>マークを選択してください</h2>
<div class="marks">
    {% for mark in marks %}
    <button onclick="location.href='{{ url_for('select_mark', mark=mark) }}'">{{ mark }}</button>
    {% endfor %}
</div>

{% if current_mark %}
<h3>{{ current_mark }} のカードを選択してください</h3>
<div class="cards">
    {% for card, img in zip(cards, cards_images) %}
    <img src="{{ img }}" alt="{{ card }}" onclick="selectCard('{{ card }}')">
    {% endfor %}
</div>
{% endif %}

<h3>役:</h3>
<div id="result">{{ result }}</div>

<div style="margin-top:20px;">
    <button onclick="location.href='{{ url_for('reset') }}'">リセット</button>
</div>

<script>
function selectCard(card) {
    fetch("/add_ajax/" + card)
    .then(resp => resp.json())
    .then(data => {
        // 選択カード更新
        const container = document.getElementById("selected-cards");
        container.innerHTML = "";
        data.selected_imgs.forEach(src=>{
            const img = document.createElement("img");
            img.src = src;
            container.appendChild(img);
        });

        // 役更新
        document.getElementById("result").textContent = data.result;

        // 5枚選択でクリック無効化
        if(data.selected.length>=5){
            document.querySelectorAll(".cards img").forEach(el=>{
                el.style.pointerEvents = "none";
                el.style.opacity = 0.5;
            });
        }
    });
}
</script>

</body>
</html>